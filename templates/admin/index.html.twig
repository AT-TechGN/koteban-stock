{% extends 'base.html.twig' %}

{% block title %}Tableau de bord - Koteban{% endblock %}

{% block body %}
    <!-- Inclure le header -->

    <div class="d2c_wrapper">
        <!-- Bouton pour toggler la sidebar en mode mobile -->
        <button class="d2c_offcanvas_toggle" type="button" data-bs-toggle="offcanvas" data-bs-target="#d2c_sidebar" aria-controls="d2c_sidebar">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Inclure la sidebar -->
        {% include 'partials/sidebar.html.twig' %}

        <!-- Main Content -->
        <div class="d2c_main p-4 ps-lg-3">
            <!-- Title -->
            <h4 class="mb-4 text-capitalize">Tableau de bord</h4>

            <!-- Dashboard Cards -->
            <div class="row d2c_home_card">
                <div class="col-xxl-9 col-xl-12">
                    <div class="row">
                        <!-- Commandes -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="btn rounded-circle shadow text-primary">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <h6 class="mt-3">Commandes</h6>
                                    <p>Total commandes</p>
                                    <h4 class="text-primary mb-0">{{ total_orders|default(0) }}</h4>
                                </div>
                            </div>
                        </div>
                        <!-- Ventes -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="btn rounded-circle shadow text-success">
                                        <i class="fas fa-cash-register"></i>
                                    </div>
                                    <h6 class="mt-3">Ventes</h6>
                                    <p>Total ventes</p>
                                    <h4 class="text-success mb-0">{{ total_sales|default(0)|number_format(2, ',', ' ') }} FG</h4>
                                </div>
                            </div>
                        </div>
                        <!-- Profils -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="btn rounded-circle shadow text-warning">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <h6 class="mt-3">Profils</h6>
                                    <p>Utilisateurs actifs</p>
                                    <h4 class="text-warning mb-0">{{ active_users|default(0) }}</h4>
                                </div>
                            </div>
                        </div>
                        <!-- Revenu -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="btn rounded-circle shadow text-danger">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <h6 class="mt-3">Revenu</h6>
                                    <p>Revenu total</p>
                                    <h4 class="text-danger mb-0">{{ total_revenue|default(0)|number_format(2, ',', ' ') }} FG</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="row">
                <div class="col-md-12 mb-4">
                    <div class="card h-auto d2c_projects_datatable">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6>Commandes récentes</h6>
                            <a href="{{ path('app_admin_order_item_index') }}" class="btn btn-primary btn-sm">Voir toutes les commandes</a>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="d2c_advanced_table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Client</th>
                                            <th>Référence</th>
                                            <th>Statut</th>
                                            <th>Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% if recent_orders is defined and recent_orders|length > 0 %}
                                            {% for order in recent_orders %}
                                                <tr>
                                                    <td>{{ order.createdAt ? order.createdAt|date('d/m/Y') : 'N/A' }}</td>
                                                    <td>{{ order.user ? order.user.username : 'Anonyme' }}</td>
                                                    <td>{{ order.reference|default('N/A') }}</td>
                                                    <td>
                                                        {% if order.status == 'delivered' %}
                                                            <span class="text-success">Livré</span>
                                                        {% elseif order.status == 'pending' %}
                                                            <span class="text-warning">En attente</span>
                                                        {% elseif order.status == 'unpaid' %}
                                                            <span class="text-danger">Non payé</span>
                                                        {% else %}
                                                            {{ order.status|default('Inconnu') }}
                                                        {% endif %}
                                                    </td>
                                                    <td>{{ order.totalAmount|default(0)|number_format(2, ',', ' ') }} FG</td>
                                                </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="5" class="text-center">Aucune commande récente</td>
                                            </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inclure le footer -->
    {% include 'partials/footer.html.twig' %}
{% endblock %}