<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Koteban{% endblock %}</title>
    {% if is_granted('IS_AUTHENTICATED_FULLY') %}
        <link rel="stylesheet" href="{{ asset('assets/css/global.css') }}?v={{ 'now'|date('U') }}">
        <link rel="stylesheet" href="{{ asset('assets/css/style.css') }}?v={{ 'now'|date('U') }}">
        <link rel="stylesheet" href="{{ asset('assets/css/responsive.css') }}?v={{ 'now'|date('U') }}">
    {% endif %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous">
    {% block stylesheets %}{% endblock %}
</head>
<body>
    <div id="app">
        {% block body %}{% endblock %}
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialiser DataTables
            if ($('#d2c_advanced_table').length) {
                $('#d2c_advanced_table').DataTable({
                    language: { url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/fr-FR.json' },
                    pageLength: 5,
                    responsive: true
                });
            }

            // Gérer le mode sombre
            if ($('#d2c_theme_changer').length) {
                console.log('Dark mode toggle found');
                $('#d2c_theme_changer').on('change', function() {
                    console.log('Dark mode toggle changed:', this.checked);
                    if (this.checked) {
                        $('body').addClass('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        $('body').removeClass('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                });

                // Charger le thème sauvegardé
                if (localStorage.getItem('theme') === 'dark') {
                    console.log('Applying dark mode from localStorage');
                    $('body').addClass('dark-mode');
                    $('#d2c_theme_changer').prop('checked', true);
                }
            } else {
                console.warn('Dark mode toggle (#d2c_theme_changer) not found');
            }

            // Debugging CSS
            console.log('CSS global.css loaded:', $('link[href*="/assets/css/global.css"]').length > 0);
            console.log('CSS style.css loaded:', $('link[href*="/assets/css/style.css"]').length > 0);
            console.log('CSS responsive.css loaded:', $('link[href*="/assets/css/responsive.css"]').length > 0);
        });
    </script>
    {% block javascripts %}{% endblock %}
</body>
</html>